<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vending Machine Inventory</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background: #2c3e50; color: white; padding: 1rem; text-align: center; }
    main { padding: 1rem; }
    section { margin-bottom: 2rem; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #f7f7f7; }
    form { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 1rem; }
    form input, form button { padding: 0.5rem; flex: 1 1 150px; }
    #buttons { margin-top: 1rem; }
    #buttons button { margin-right: 10px; }
    #profit { font-weight: bold; margin-top: 1rem; }
    .hidden { display: none; }
    input[type="number"] { width: 70px; padding: 5px; }
    @media (max-width: 600px) {
      table { font-size: 0.8rem; }
      form { flex-direction: column; }
    }
  </style>
</head>

<body>

<header>
  <h1>Vending Machine Inventory</h1>
</header>

<main>
  <section>
    <h2>Inventory</h2>
    <table id="inventory-table">
      <thead>
        <tr>
          <th>Item</th>
          <th>Cost</th>
          <th>Price</th>
          <th>Start Inv.</th>
          <th>Current Inv.</th>
          <th>Restock</th>
          <th>Units Sold</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h2>Add Item</h2>
    <form id="add-form">
      <input type="text" id="name" placeholder="Item Name" required>
      <input type="number" id="cost" placeholder="Cost" step="0.01" required>
      <input type="number" id="price" placeholder="Retail Price" step="0.01" required>
      <input type="number" id="startInv" placeholder="Start Inventory" required>
      <button type="submit">Add Item</button>
    </form>
  </section>

  <section id="buttons">
    <button onclick="updateInventory()">Update Inventory</button>
    <button onclick="generateReport()">Generate Report</button>
    <button onclick="exportInventory()">Export Inventory</button>
    <input type="file" id="import-file" onchange="importInventory()">
  </section>

  <div id="profit">
    Total Profit: $<span id="profit-amount">0.00</span>
  </div>

  <div id="report" class="hidden">
    <h3>Sales Report</h3>
    <pre id="report-content"></pre>
  </div>
</main>

<script>
  class Item {
    constructor(name, cost, price, startInventory) {
      this.name = name;
      this.cost = parseFloat(cost);
      this.price = parseFloat(price);
      this.startInventory = parseInt(startInventory);
      this.currentInventory = parseInt(startInventory);
      this.unitsSold = 0;
    }
  }

  class VendingMachine {
    constructor() {
      this.inventory = {};
    }

    addItem(name, cost, price, startInventory) {
      this.inventory[name] = new Item(name, cost, price, startInventory);
      this.saveInventory();
      this.renderInventory();
    }

    renderInventory() {
      const tbody = document.querySelector("#inventory-table tbody");
      tbody.innerHTML = "";

      for (let name in this.inventory) {
        const item = this.inventory[name];
        const row = document.createElement("tr");

        row.innerHTML = `
          <td>${item.name}</td>
          <td>$${item.cost.toFixed(2)}</td>
          <td>$${item.price.toFixed(2)}</td>
          <td>${item.startInventory}</td>
          <td><input type="number" id="current-${item.name}" value="${item.currentInventory}" min="0"></td>
          <td><input type="number" id="restock-${item.name}" value="0" min="0"></td>
          <td>${item.unitsSold}</td>
        `;
        tbody.appendChild(row);
      }
      this.updateProfit();
    }

    updateInventory() {
      for (let name in this.inventory) {
        const item = this.inventory[name];
        const newCurrent = parseInt(document.getElementById(`current-${name}`).value) || 0;
        const restockAmount = parseInt(document.getElementById(`restock-${name}`).value) || 0;

        const countedSold = item.startInventory - newCurrent;
        item.unitsSold = countedSold > 0 ? countedSold : 0;
        item.currentInventory = newCurrent + restockAmount;
        item.startInventory = item.currentInventory; // After restock, reset startInventory
      }
      this.saveInventory();
      this.renderInventory();
    }

    totalProfit() {
      let profit = 0;
      for (let item of Object.values(this.inventory)) {
        profit += item.unitsSold * (item.price - item.cost);
      }
      return profit.toFixed(2);
    }

    updateProfit() {
      document.getElementById("profit-amount").innerText = this.totalProfit();
    }

    generateReport() {
      let reportText = "";
      for (let item of Object.values(this.inventory)) {
        reportText += `${item.name}: ${item.unitsSold} units sold\n`;
      }
      document.getElementById("report").classList.remove("hidden");
      document.getElementById("report-content").textContent = reportText;
    }

    saveInventory() {
      localStorage.setItem('vendingMachineInventory', JSON.stringify(this.inventory));
    }

    loadInventory() {
      const saved = localStorage.getItem('vendingMachineInventory');
      if (saved) {
        const data = JSON.parse(saved);
        for (let name in data) {
          const { cost, price, startInventory, currentInventory, unitsSold } = data[name];
          const item = new Item(name, cost, price, startInventory);
          item.currentInventory = currentInventory;
          item.unitsSold = unitsSold;
          this.inventory[name] = item;
        }
        this.renderInventory();
      } else {
        setTimeout(() => {
          if (confirm("No inventory found. Would you like to import data?")) {
            document.getElementById("import-file").click();
          }
        }, 500);
      }
    }

    exportInventory() {
      const data = JSON.stringify(this.inventory);
      const blob = new Blob([data], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'inventory.json';
      link.click();
    }

    importInventory() {
      const file = document.getElementById("import-file").files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        const data = JSON.parse(e.target.result);
        for (let name in data) {
          const { cost, price, startInventory, currentInventory, unitsSold } = data[name];
          const item = new Item(name, cost, price, startInventory);
          item.currentInventory = currentInventory;
          item.unitsSold = unitsSold;
          this.inventory[name] = item;
        }
        this.saveInventory();
        this.renderInventory();
      };
      reader.readAsText(file);
    }
  }

  const vm = new VendingMachine();
  vm.loadInventory();

  document.getElementById("add-form").addEventListener("submit", (e) => {
    e.preventDefault();
    const name = document.getElementById("name").value.trim();
    const cost = document.getElementById("cost").value;
    const price = document.getElementById("price").value;
    const startInv = document.getElementById("startInv").value;

    if (name) {
      vm.addItem(name, cost, price, parseInt(startInv));
      e.target.reset();
    }
  });

  function updateInventory() {
    vm.updateInventory();
  }

  function generateReport() {
    vm.generateReport();
  }

  function exportInventory() {
    vm.exportInventory();
  }

  function importInventory() {
    vm.importInventory();
  }
</script>

</body>
</html>
